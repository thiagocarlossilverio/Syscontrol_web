$(function () {    $.getScript('/adm/default/js/lib/mascaras.js', function () {        $(".data").mask("99/99/9999");        $(".data").datepicker({            dateFormat: "dd/mm/yy",            dayNamesMin: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"],            monthNames: ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"]});    });    $(".btnPrint").live("click", function () {        var id = $(this).data('id');        if (id) {            window.open("/admin/viagens/ticket/id/" + id, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=50,left=300,width=1050,height=700");        }    });    $('#destino_copia').select2({        tags: true,        multiple: true,        tokenSeparators: [',', ''],        minimumInputLength: 3,        ajax: {            url: "/admin/viagens/usuarios-ajax",            dataType: 'json',            data: function (term, page) {                return {                    q: term                };            },            results: function (data, page) {                return {                    results: data                };            }        }    });    $(document).on("click", ".enviarEmail", function (event) {        event.preventDefault();        $('#enviar-email').show();        var id_viagem = $(this).attr('param');        if (id_viagem == '') {            alert('Erro nos sitema');            return false;        } else {            $('#id_viagem').val(id_viagem);            $('#modal-email').modal('show');        }    });    $(document).on("click", "#enviar-email", function (event) {        //event.preventDefault();        var id_viagem = $('#id_viagem').val();        var destinos = $('#destino_copia').val();        var progress = '<img id="loader" src="/adm/default/img/ajax.gif" alt="Carregando...">';        if (id_viagem == '' || destinos == '') {            alert('Não foi possível enviar o email!');            $(this).show();            return false;        } else {            $(this).hide();            $('.modal-footer .cancelar').after(progress);            $.ajax({                url: '/admin/viagens/envia-email-ajax/',                type: 'POST',                dataType: 'json',                data: {                    id_viagem: id_viagem,                    destinos: destinos                }            }).done(function (data) {                if (data.status == 'ok') {                    $('#modal-email').modal('hide');                    $('#loader').remove();                    alert('Enviado com sucesso!');                } else {                    $('#loader').remove();                    $('#enviar-email').show();                    alert('falha ao enviar');                }            });        }    });    $(document).on("change", "#filtro-veiculo, #filtro-categoria, #filtro-subcategoria, #filtro-motorista", function () {        var categoria = $('#filtro-categoria option:selected').val();        var subcategoria = $('#filtro-subcategoria option:selected').val();        var veiculo = $('#filtro-veiculo option:selected').val();        var motorista = $('#filtro-motorista option:selected').val();        var data_inicio = $('#data_inicio').val();        var data_fim = $('#data_fim').val();        if (veiculo !== '') {            var param_veiculo = '/veiculo/' + veiculo;        } else {            var param_veiculo = '';        }        if (motorista !== '') {            var param_motorista = '/motorista/' + motorista;        } else {            var param_motorista = '';        }        if (categoria !== '') {            var param_categoria = '/categoria/' + categoria;        } else {            var param_categoria = '';        }        if (subcategoria !== 'undefined' && subcategoria != '' && subcategoria != '0') {            var param_subcategoria = '/subcategoria/' + subcategoria;        } else {            var param_subcategoria = '';        }        if (data_inicio == '' || data_inicio == 'undefined') {            alerta("Insira a data inicial!");            return false;        }        if (data_fim == '' || data_fim == 'undefined') {            alerta("Insira a data final!");            return false;        }        if (VerificaData(data_fim) < VerificaData(data_inicio)) {            $('#data_fim').val('');            alerta("Atenção a data final não pode ser menor que a data inicial!");            return false;        }        if (data_inicio !== '') {            var param_data_inicio = '/inicio/' + ConverteData(data_inicio);        } else {            var param_data_inicio = '';        }        if (data_fim !== '') {            var param_data_data_fim = '/fim/' + ConverteData(data_fim);        } else {            var param_data_data_fim = '';        }        window.location = '/admin/relatorios/viagens' + param_veiculo + param_motorista + param_categoria + param_subcategoria + param_data_inicio + param_data_data_fim;    });    $('#pesquisar').click(function () {        var categoria = $('#filtro-categoria option:selected').val();        var subcategoria = $('#filtro-subcategoria option:selected').val();        var veiculo = $('#filtro-veiculo option:selected').val();        var motorista = $('#filtro-motorista option:selected').val();        var data_inicio = $('#data_inicio').val();        var data_fim = $('#data_fim').val();        if (veiculo !== '') {            var param_veiculo = '/veiculo/' + veiculo;        } else {            var param_veiculo = '';        }        if (motorista !== '') {            var param_motorista = '/motorista/' + motorista;        } else {            var param_motorista = '';        }        if (categoria !== '') {            var param_categoria = '/categoria/' + categoria;        } else {            var param_categoria = '';        }        if (subcategoria !== 'undefined' && subcategoria != '' && subcategoria != '0') {            var param_subcategoria = '/subcategoria/' + subcategoria;        } else {            var param_subcategoria = '';        }        if (data_inicio == '' || data_inicio == 'undefined') {            alerta("Insira a data inicial!");            return false;        }        if (data_fim == '' || data_fim == 'undefined') {            alerta("Insira a data final!");            return false;        }        if (VerificaData(data_fim) < VerificaData(data_inicio)) {            $('#data_fim').val('');            alerta("Atenção a data final não pode ser menor que a data inicial!");            return false;        }        if (data_inicio !== '') {            var param_data_inicio = '/inicio/' + ConverteData(data_inicio);        } else {            var param_data_inicio = '';        }        if (data_fim !== '') {            var param_data_data_fim = '/fim/' + ConverteData(data_fim);        } else {            var param_data_data_fim = '';        }        window.location = '/admin/relatorios/viagens' + param_veiculo + param_motorista + param_categoria + param_subcategoria + param_data_inicio + param_data_data_fim;    });    $(document).on("click", ".visualizaViagem", function (event) {        event.preventDefault();        var param = $(this).attr('param');        $.ajax({            url: '/admin/viagens/visualizar/',            dataType: 'json',            data: {                param: param            }        }).done(function (dados) {            if (dados.placa !== '' && dados.placa !== 'undefined' && dados.placa !== null) {                $('#veiculo').html(dados.placa);            }            if (dados.nome_categoria !== '' && dados.nome_categoria !== 'undefined' && dados.nome_categoria !== null) {                $('#categoria').html(dados.nome_categoria);            }            if (dados.nome_subcategoria !== '' && dados.nome_subcategoria !== 'undefined' && dados.nome_subcategoria !== null) {                $('#subcategoria').html(dados.nome_subcategoria);            }            if (dados.data_abertura !== '' && dados.data_abertura !== 'undefined' && dados.data_abertura !== null) {                $('#dt_abertura').html(dados.data_abertura);            }            if (dados.data_fechamento !== '' && dados.data_fechamento !== 'undefined' && dados.data_fechamento !== null) {                $('#dt_fechamento').html(dados.data_fechamento);            }            if (dados.peso_tara !== '' && dados.peso_tara !== 'undefined' && dados.peso_tara !== null) {                $('#peso_tara').html(dados.peso_tara);            } else {                $('#peso_tara').parent().hide();            }            if (dados.peso_bruto !== '' && dados.peso_bruto !== 'undefined' && dados.peso_bruto !== null) {                $('#peso_bruto').html(dados.peso_bruto);            } else {                $('#peso_bruto').parent().hide();            }            if (dados.peso_liquido !== '' && dados.peso_liquido !== 'undefined' && dados.peso_liquido !== null) {                $('#peso_liquido').html(dados.peso_liquido);            } else {                $('#peso_liquido').parent().hide();            }            if (dados.peso_medio != '' && dados.peso_medio != 'undefined' && dados.peso_medio != null) {                $('#peso_medio').html(dados.peso_medio) + ' K.G';                $('#peso_medio').parent().show();            } else {                $('#peso_medio').parent().hide();            }            if (dados.peso_nota != '' && dados.peso_nota != 'undefined' && dados.peso_nota != null) {                $('#peso_nota').html(dados.peso_nota + ' K.G');                $('#peso_nota').parent().show();            } else {                $('#peso_nota').parent().hide();            }            if (dados.quantidade != '' && dados.quantidade != 'undefined' && dados.quantidade != null) {                $('#quantidade').html(dados.quantidade + ' Cabeças');                $('#quantidade').parent().show();            } else {                $('#quantidade').parent().hide();            }            if (dados.km_inicial !== '' && dados.km_inicial !== 'undefined' && dados.km_inicial !== null) {                $('#km_inicial').html(dados.km_inicial);            }            if (dados.km_carga !== '' && dados.km_carga !== 'undefined' && dados.km_carga !== null) {                $('#km_carga').html(dados.km_carga);            }            if (dados.km_descarga !== '' && dados.km_descarga !== 'undefined' && dados.km_descarga !== null) {                $('#km_descarga').html(dados.km_descarga);            }            if (dados.km_rodados_vazio !== '' && dados.km_rodados_vazio !== 'undefined' && dados.km_rodados_vazio !== null) {                $('#km_rodados_vazio').html(dados.km_rodados_vazio);            }            if (dados.km_rodados_carregado !== '' && dados.km_rodados_carregado !== 'undefined' && dados.km_rodados_carregado !== null) {                $('#km_rodados_carregado').html(dados.km_rodados_carregado);            }            if (dados.km_final !== '' && dados.km_final !== 'undefined' && dados.km_final !== null) {                $('#km_final').html(dados.km_final);            }            if (dados.km_rodados !== '' && dados.km_rodados !== 'undefined' && dados.km_rodados !== null) {                $('#km_rodados').html(dados.km_rodados);            }            if (dados.origem !== '' && dados.origem !== 'undefined' && dados.origem !== null) {                $('#origem').html(dados.origem);            }            if (dados.nome_origem_carregamento !== '' && dados.nome_origem_carregamento !== 'undefined' && dados.nome_origem_carregamento !== null) {                $('#origem_carregamento').html(dados.nome_origem_carregamento);            }            if (dados.nome_destino_carregamento !== '' && dados.nome_destino_carregamento !== 'undefined' && dados.nome_destino_carregamento !== null) {                $('#destino_carregamento').html(dados.nome_destino_carregamento);            }            if (dados.destino_final !== '' && dados.destino_final !== 'undefined' && dados.destino_final !== null) {                $('#destino_final').html(dados.destino_final);            }            if (dados.numero_nota !== '' && dados.numero_nota !== 'undefined' && dados.numero_nota !== null) {                $('#numero_nota').html(dados.numero_nota);            }            if (dados.local_abertura !== '' && dados.local_abertura !== 'undefined' && dados.local_abertura !== null) {                $('#local_pesagem_abertura').html(dados.local_abertura);            } else {                $('#local_pesagem_abertura').parent().hide();            }            if (dados.local_fechamento !== '' && dados.local_fechamento !== 'undefined' && dados.local_fechamento !== null) {                $('#local_pesagem_fechamento').html(dados.local_fechamento);            } else {                $('#local_pesagem_fechamento').parent().hide();            }            if (dados.pesagem_manual_inicio == '1') {                $('#tipo_pesagem_abertura').html('Manual');            } else {                $('#tipo_pesagem_abertura').html('Automático');            }            if (dados.pesagem_manual_fim !== '' && dados.pesagem_manual_fim !== 'undefined' && dados.pesagem_manual_fim !== null) {                if (dados.pesagem_manual_fim == '1') {                    $('#tipo_pesagem_fechamento').html('Manual');                } else {                    $('#tipo_pesagem_fechamento').html('Automático');                }            } else {                if (dados.tipo_pesagem_abertura == '3') {                    $('#tipo_pesagem_fechamento').parent().remove();                } else {                    $('#tipo_pesagem_fechamento').html('Viagem não finalizada!');                }            }            if (dados.coordenadas_abertura !== '') {                var html_entrada = '<iframe  width="100%" height="180" src="https://maps.google.com/maps?width=100%&amp;height=600&amp;hl=en&amp;coord=' + dados.coordenadas_abertura + '&q=' + dados.coordenadas_abertura + '&ie=UTF8&amp;t=&amp;z=14&amp;iwloc=B&amp;output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>';                $('.frame_entrada').html(html_entrada);            } else {                $('.frame_entrada iframe').remove();            }            if (dados.coordenadas_fechamento !== '') {                var html_saida = '<iframe  width="100%" height="180" src="https://maps.google.com/maps?width=100%&amp;height=600&amp;hl=en&amp;coord=' + dados.coordenadas_fechamento + '&q=' + dados.coordenadas_fechamento + '&ie=UTF8&amp;t=&amp;z=14&amp;iwloc=B&amp;output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>';                $('.frame_saida').html(html_saida);            } else {                $('.frame_saida iframe').remove();            }            $('#myModal').modal('show');        });    });    $("#btnPrint").click(function () {        //get the modal box content and load it into the printable div        $(".printable").html($(".dados-abastecida").html());        $(".printable").printThis();    });});function VerificaData(str) {    var partes = str.split("/");    return new Date(partes[2], partes[1] - 1, partes[0]);}function ConverteData(date) {    return date.split('/').reverse().join('-');}function alerta(msg) {    $("#mensagem").html("<p>" + msg + "</p>");    $("#mensagem").dialog({        modal: true,        buttons: {            Ok: function () {                $(this).dialog("close");            }        }    });    $("#mensagem").dialog("open");}function loadPageVar(sVar) {    return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURI(sVar).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));}