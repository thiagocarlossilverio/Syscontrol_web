<?phpclass Admin_Model_Categorias extends Zend_Db_Table {    protected $_name = 'carga_categorias';    protected $_primary = 'id';    public function init() {        $viewRenderer = Zend_Controller_Action_HelperBroker::getStaticHelper('ViewRenderer');        $viewRenderer->init();        $this->view = $viewRenderer->view;    }    public function insert(array $data) {        if (!is_array($data))            return false;        if (!empty($data['nome'])) {            $url = $this->view->RemoverAcentos($data['nome']);            $data['url_tratada'] = $this->view->CreateSlug($url);            $data['nome'] = ucfirst($data['nome']);        }        if (is_numeric($data['id'])) {            $this->update($data, "id = " . $data['id']);            return $data['id'];        }        unset($data['id']);        $info = $this->info();        $data_insert = array_intersect_key($data, $info['metadata']);        parent::insert($data_insert);    }    public function Dados() {        $sql = $this->select();        if ($result = $this->fetchRow($sql)) {            return $result;        }    }        public function GetUrl($url) {        $sql = $this->select()                    ->where('url_tratada = ?', $url);        if ($result = $this->fetchRow($sql)) {            $result = $result->toArray();            $result['subcategorias'] = $this->getChildrensAdmin($result['id']);            return $result;        }else{            return FALSE;        }    }    public function ListarCategorias() {        $sql = $this->select()->where("pai = 0");        if($categorias = $this->fetchAll($sql)){            return $categorias->toArray();        }else{            return FALSE;        }        }    public function getChildrensAdmin($categoria) {        $sql = $this->select()->where("pai = ?", $categoria)->order("nome");       if($result = $this->fetchAll($sql)){//        foreach ($exe as $key => $sub)//            $exe[$key]['filhas'] = $this->getChildrensAdmin($sub);        return $result->toArray();       }    }    public function ListarAll() {        $sql = $this->select()->where("pai = 0");        $categorias = $this->fetchAll($sql)->toArray();        foreach ($categorias as $key => $value):            $categorias[$key]['filhas'] = $this->getChildrens($value['id']);        endforeach;        return $categorias;    }    public function getSub() {        $sql = $this->select()->where("pai != 0");        if ($sub = $this->fetchAll($sql)) {            return $sub->toArray();        } else {            return false;        }    }        public function getSubs($categoria) {        $sql = $this->select()                ->where("pai = ?", $categoria)                 ->where("ativo = ?", 1)                ->order("nome");       if( $exe = $this->fetchAll($sql)){           return $exe->toArray();       }else{           return false;       }          }    public function getChildrens($categoria) {        $sql = $this->select()->where("pai = ?", $categoria)->order("nome");        $exe = $this->fetchAll($sql)->toArray();        foreach ($exe as $key => $sub)            $exe[$key]['filhas'] = $this->getChildrens($sub['id']);        return $exe;    }    public function GetDados($id) {        $sql = $this->select()                    ->where("id = ?", $id);                            if ($result = $this->fetchRow($sql)) {            return $result->toArray();        }    }    public function update(array $data, $where) {        $info = $this->info();        $data_insert = array_intersect_key($data, $info['metadata']);        parent::update($data_insert, $where);    }    public function Lista() {        $sql = $this->select()                    ->order("id");        if ($categorias = $this->fetchAll($sql)) {            return $categorias->toArray();        } else {            return false;        }    }    public function ListCategory() {        $sql = $this->select()                    ->where("pai = 0");                if ($categorias = $this->fetchAll($sql)) {            return $categorias->toArray();        } else {            return false;        }    }    public function GetAll() {        $sql = $this->select()                    ->where('ativo = ?', 1)                    ->order("id");            if ($categorias = $this->fetchAll($sql)) {            return $categorias->toArray();        } else {            return false;        }    }}